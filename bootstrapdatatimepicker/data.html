<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>datatimepicker</title>
  <link href="css/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="css/plugins/bootstrap-datetimepicker/bootstrap-datetimepicker.min.css" rel="stylesheet">
  <link href="css/plugins/select2/dist/css/select2.min.css" rel="stylesheet">
  
  <link href="scss/icons/font-awesome/css/font-awesome.min.css" rel="stylesheet">
  <!-- jQuery -->
  <script src="css/plugins/jquery/jquery.min.js"></script>
  <!-- Bootstrap tether Core JavaScript -->
  <script src="css/plugins/bootstrap/js/popper.min.js"></script>
  <script src="css/plugins/bootstrap/js/bootstrap.min.js"></script>

</head>

<body>
  <div class="col-lg-12">
    <div class="card card-outline-info">
      <div class="card-header">
        <h4 class="m-b-0 text-white">用友对账</h4>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-4">
            <div class="form-group row">
              <div class="col-md-12">
                <select class="form-control custom-select" id="companyname">
                  <option></option>
                </select>
                
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="form-group row">
              <div class="col-md-12">
                
                <div class="input-group date form_date">
                  <input type="text" class="form-control datepicker" id="compareaccount" placeholder="yyyy-mm">
                  <span class="input-group-addon">
                    <i class="fa fa-calendar"></i>
                  </span>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <button type="button" class="btn btn-success search">
              <i class="fa fa-search"></i> 查询
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

</html>
<script src="css/plugins/bootstrap-datetimepicker/bootstrap-datetimepicker.min.js"></script>
<script src="css/plugins/bootstrap-datetimepicker/locales/bootstrap-datetimepicker.zh-CN.js"></script>
<script src="css/plugins/select2/dist/js/select2.min.js"></script>
<script>
  //初始化日期插件
  $('#compareaccount').datetimepicker({
    format: "yyyy-mm",
    language: "zh-CN",
    autoclose: true,
    todayBtn: false,
    todayHighlight: true,
    showMeridian: false,
    fontAwesome: true,
    pickerPosition: 'bottom-right',
    minView: 3,
    startView: 3

  })

  //获取公司的下拉列表

  function getCompanyList(){
    var url = commonUtil.getBaseUrl( false, 'sys' ) + '/app/biz/bizu8sum/queryU8Account'
    var data = {
      subCodes:'company-U8Company-ReimbursementType-employeeType-capitalizedProject-'
    }
    var companyList;

    //获取公司的下拉列表
    submitForm( url, 'get', data, true, function( res ){
      console.log( res );
      companyList = res.data.U8Company;
    })

    //处理成select2的需要的数据格式
    if( companyList ){
      var newCompanyList = $.map(companyList,function(item,index){
        return {
          id:item.id,
          text:item.nameChs
        }
      })
    }

    return newCompanyList
  }





  // var matchStart = function (params, data) {
    // If there are no search terms, return all of the data
    // if ($.trim(params.term) === '') {
    //   return data;
    // }

    // Do not display the item if there is no 'text' property
    // if (typeof data.text === 'undefined') {
    //   return null;
    // }

    // `params.term` should be the term that is used for searching
    // `data.text` is the text that is displayed for the data object
    // if (data.text.indexOf(params.term) > -1) {
    //   var modifiedData = $.extend({}, data, true);
    //   modifiedData.text += ' (matched)';

      // You can return modified objects from here
      // This includes matching the `children` how you want in nested data sets
    //   return modifiedData;
    // }

    // Return `null` if the term should not be displayed
  //   return null;
  // }

  $("#companyname").select2({
    // isAjax: true,
    //多选的时候使用对象的形式
    // placeholder: {
    //   id: '-1',
    //   text: '请选择公司'
    // },
    // multiple: true,
    //单选时使用字符的形式
    placeholder:'请选择公司',
    //matcher: matchStart,
    // ajax: {
    //   url: '#',
    //   dataType: 'json',
    //   delay: 250,// 延迟显示
    // data: function (params) {
    //   console.log(params)
    //   return {
    //     id: params.term, // 搜索框内输入的内容，传递到Java后端的parameter为username
    //   };
    // },
    // beforeSend: function (request) {
    //   request.setRequestHeader("Authorization", "Arch6WithCloud " + localStorage.getItem("JSESSIONID"));
    // },
    // 分页
    // processResults: function (data, params) {
      // params.page = params.page || 1;

      // return {
      //   results: data.data,// 后台返回的数据集
      //   pagination: {
      //     more: params.page < data.total// 总页数为10，那么1-9页的时候都可以下拉刷新
      //   }
      // };
    // },
      // cache: false
    //},

    data: [
      {
        id:1,
        text:'公司一'
      },
      {
        id:2,
        text:'公司二'
      },
      {
        id:3,
        text:'公司三'
      },
    ]
  });


  //提交数据
  $('.btn-success').click(function(){
    downLoadExcel();
  })


  function downLoadExcel(){
    //获取公司id
    var id = $('#companyname').val();
    //获取时间
    var time = $('#compareaccount').val();
    console.log(typeof time)
    if(time){
      var year = time.split('-')[0];
      var month = time.split('-')[1];
    }else{
      return
    }
    var url = commonUtil.getBaseUrl( false, 'sys' ) + '/app/biz/bizu8sum/queryU8Account';
    var data = {
      subCodes: id || '',
      year: year || '',
      month: month || ''
    };
    var companyList;

    //获取公司的下拉列表
    submitForm( url, 'post', data, false, function( res ){
      console.log( res );
      companyList = res.data.U8Company;
    })
  }
  

  //提交表单
  function submitForm(url,type,data,async,callback) {
    $.ajax({
      url: url||'#',
      type: type||'get',
      data: data||'',
      dataType: 'json',
      async: async||false,
      success: function (res) {
        callback(res)
      }
    })
  }
</script>